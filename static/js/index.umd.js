!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).HTMLAutoCheckElement=e()}(this,(function(){"use strict";class t extends Error{constructor(t){super(),this.response=t}}const e=new WeakMap,n=["typeMismatch","badInput","valueMissing","tooShort","tooLong","rangeUnderflow","rangeOverflow","stepMismatch","patternMismatch"];function s(t){const s=t.currentTarget;if(!(s instanceof c))return;const i=s.input;if(i instanceof HTMLInputElement)if(i.validity.customError&&i.setCustomValidity(""),i.checkValidity()){if(s.dispatchEvent(new CustomEvent("auto-check:".concat(s.href?"native-success":"success"),{bubbles:!0})),s.href){const t=e.get(s);if(t){if(!s.dispatchEvent(new CustomEvent("auto-check:ajax-start",{bubbles:!0,cancelable:!0})))return;i.setCustomValidity("Verifying....."),t(s)}}}else{const t=function(t,e){let s,i=e.msg;if(!i)return null;try{const t=JSON.parse(i);s="object"==typeof t?Object.assign({all:""},t):{all:t}}catch(t){s={all:i}}const c=n.find(e=>Reflect.get(t,e))||"all";return s[c]}(i.validity,s);if(!t)return;s.dispatchEvent(new CustomEvent("auto-check:error",{detail:{message:t},bubbles:!0}))}}function i(e){const n=e.href,s=e.input;if(!n||!s||!s.value.trim())return;s.setCustomValidity("Verifying.....");const i="".concat(n.includes("?")?n:"".concat(n,"?")).concat(new URLSearchParams({[s.name]:s.value.trim()}).toString()),c={method:"GET",mode:"cors",credentials:"same-origin",headers:new Headers({"X-Requested-With":"XMLHttpRequest",Accept:"application/json"})};fetch(i,c).then(e=>{if(e.ok)return e.text();throw new t(e)}).then(()=>{s.setCustomValidity(""),e.dispatchEvent(new CustomEvent("auto-check:ajax-end",{bubbles:!0})),e.dispatchEvent(new CustomEvent("auto-check:ajax-success",{bubbles:!0})),e.dispatchEvent(new CustomEvent("auto-check:success",{bubbles:!0}))}).catch(async n=>{const i={bubbles:!0,detail:{}};if(n instanceof t)try{const t=await n.response.json();i.detail.message=t.message}catch(t){i.detail.message="Validation failed"}else i.detail.message="Validation failed";s.setCustomValidity(i.detail.message),e.dispatchEvent(new CustomEvent("auto-check:ajax-end",{bubbles:!0})),e.dispatchEvent(new CustomEvent("auto-check:ajax-error",i)),e.dispatchEvent(new CustomEvent("auto-check:error",i))})}class c extends HTMLElement{constructor(){super(),e.set(this,function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,n=null;return function(){n&&(window.clearTimeout(n),n=null),n=window.setTimeout(()=>{const e=[];for(let t=0;t<arguments.length;t++)e[t]=arguments[t];t.apply(this,e)},e)}}(i.bind(this),500))}connectedCallback(){this.addEventListener("input",s);const t=this.input;t&&(t.autocomplete="off",t.spellcheck=!1)}disconnectedCallback(){this.removeEventListener("input",s),e.delete(this);const t=this.input;t&&t.setCustomValidity("")}get href(){const t=this.getAttribute("href");if(!t)return"";const e=this.ownerDocument.createElement("a");return e.href=t,e.href}set href(t){t?this.setAttribute("href",t):this.removeAttribute("href")}get msg(){return this.getAttribute("msg")}set msg(t){t?this.setAttribute("msg",t):this.removeAttribute("msg")}get input(){return this.querySelector("input")}}return window.customElements.get("auto-check")||(window.HTMlAutoCheckElement=c,window.customElements.define("auto-check",c)),c}));
//# sourceMappingURL=index.umd.js.map
