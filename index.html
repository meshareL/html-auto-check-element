<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

	<title>HTML Auto Check Element</title>
	<meta name="description" value="HTMLAutoCheckElement demo">

	<link rel="stylesheet" href="./static/css/normalize.css">
	<link rel="stylesheet" href="./static/css/index.css">
</head>
<body>
	<h1 style="text-align: center; margin: 30px 0;">HTML Auto Check Element</h1>

	<div class="forms">
		<form autocomplete="off">
			<p>The network is always wrong when typing "
				<span class="text-red">validate@email.com</span>
				"
			</p>
			<auto-check class="form-group required" href="/existed" msg='{"typeMismatch": "type mismatch", "valueMissing": "value missing"}'>
				<label for="mail">Email</label>
				<input id="mail" class="form-control" name="email" placeholder="email" required autofocus type="email">
				<p class="state"></p>
			</auto-check>
			<auto-check class="form-group required" msg='{"valueMissing": "value missing", "patternMismatch": "pattern mismatch"}'>
				<label for="username">Username</label>
				<input id="username" class="form-control" name="username" placeholder="pattern: ^username$" pattern="^username$" required type="text">
				<p class="state"></p>
			</auto-check>
			<button type="submit">Submit</button>
		</form>
	</div>

	<script type="text/javascript">
		const native = window.fetch;
		const faked = function (url, options) {
			url = decodeURIComponent(url);
			let path = `https://httpbin.org/status/${url.includes('validate@email.com') ? '422' : '200'}`;
			return native(path, options);
		};
		window.fetch = faked;

		function autoCheckEvent(event) {
			const checkElement = event.target;
			if (!(checkElement instanceof window.HTMlAutoCheckElement)) return;

			const state = checkElement.querySelector('.state');
			if (!(state instanceof HTMLElement)) return;

			switch (event.type) {
				case 'auto-check:success':
					checkElement.classList.remove('is-loading', 'is-errored');
					checkElement.classList.add('is-successful');
					state.classList.add('text-green');
					state.classList.remove('text-red');
					state.textContent = 'successful';
					break;
				case 'auto-check:error':
					checkElement.classList.remove('is-loading', 'is-successful');
					checkElement.classList.add('is-errored');
					state.classList.add('text-red');
					state.classList.remove('text-green');
					state.textContent = event.detail.message;
					break;
				case 'auto-check:ajax-start':
					checkElement.classList.remove('is-successful', 'is-errored');
					checkElement.classList.add('is-loading');
					state.classList.remove('text-green', 'text-red');
					state.textContent = 'server endpoint start';
					break;
				default:
					return;
			}
		}
		document.addEventListener('auto-check:success', autoCheckEvent);
		document.addEventListener('auto-check:error', autoCheckEvent);
		document.addEventListener('auto-check:ajax-start', autoCheckEvent);
	</script>

	<script type="text/javascript" src="./static/js/index.umd.js"></script>
</body>
</html>